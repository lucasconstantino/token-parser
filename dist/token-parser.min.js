/**
 * TokenParser - A tokenized string parser for JavaScript
 * @name token-parser
 * @version v0.0.1
 * @link https://github.com/lucasconstantino/token-parser
 * @license MIT
 */
!function(f){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=f();else if("function"==typeof define&&define.amd)define([],f);else{var g;g="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,g.TokenParser=f()}}(function(){return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module){function TokenParser(cache){this.lexer=new Lexer,this.errorHandlers=[],this.nodeTypes={},this.expressions=new ExpressionParser(cache)}var ExpressionParser=require("./lib/expression-parser"),Lexer=require("./lib/lexer"),types=require("./lib/node-types"),CompoundType=types.COMPOUND;TokenParser.prototype.init=function(){this.lexer.init();for(var i in types)types.hasOwnProperty(i)&&this.nodeType(i,types[i])},TokenParser.prototype.nodeType=function(name,compiler){return"undefined"==typeof compiler?this.nodeTypes[name]:this.nodeTypes[name]=compiler;var compiler},TokenParser.prototype.filter=function(name,filter){if("undefined"==typeof filter)return this.expressions.filters[name];if(typeof filter===!1){var filter=this.expressions.filters[name];return delete this.expressions.filters[name],filter}return this.expressions.filters[name]=filter},TokenParser.prototype.scan=function(text){if(this.lexer||!this.throwError("TokenParser must be initialized")){this.lexer.setInput(text);for(var lexed,tokens=[];"undefined"!=typeof(lexed=this.lexer.lex());)tokens.push(lexed);return tokens}},TokenParser.prototype.parse=function(tokens){for(var node,nodes=[],i=0;i<tokens.length;)(node=types[tokens[i].type].parse.call(this,tokens[i],i,tokens))&&nodes.push(node),i++;return nodes},TokenParser.prototype.compile=function(text){var nodes=this.parse(this.scan(text));return new CompoundType(nodes)},TokenParser.prototype.replace=function(text){var compound=this.compile(text),args=[].slice.call(arguments,1);return compound.replace.apply(compound,args)},TokenParser.prototype.addErrorHandler=function(callback){this.errorHandlers.push(callback)},TokenParser.prototype.removeErrorHandler=function(callback){var index;(index=this.errorHandlers.indexOf(callback)>-1)&&this.errorHandlers.splice(index,1)},TokenParser.prototype.throwError=function(){var e,args=[].slice.call(arguments);for(e=0;e<this.errorHandlers.length;e++)if(this.errorHandlers[e].apply(this,args)===!0)return!0;throw new Error(args[0])},module.exports=TokenParser},{"./lib/expression-parser":2,"./lib/lexer":3,"./lib/node-types":12}],2:[function(require,module){function ExpressionParser(cache){function compile(src){var cached;if("string"!=typeof src)throw new TypeError("src must be a string, instead saw '"+typeof src+"'");return compile.cache?(cached=compile.cache[src],cached||(cached=compile.cache[src]=parser.parse(src)),cached):parser.parse(src)}function getFilter(name){return filters[name]}var filters={},Lexer=angularExpressions.Lexer,Parser=angularExpressions.Parser,lexer=new Lexer({}),parser=new Parser(lexer,getFilter);compile.cache=cache===!1?!1:{},this.Lexer=Lexer,this.Parser=Parser,this.compile=compile,this.filters=filters}var angularExpressions=require("angular-expressions");module.exports=ExpressionParser},{"angular-expressions":14}],3:[function(require,module){var Lexer=module.exports=require("lex"),states=require("./states"),rules=require("./rules");Lexer.prototype.init=function(){this.postponed=[],this.errorHandlers=[],this.states=states;for(var r=0;r<rules.length;r++)this.addRule(rules[r].regex,rules[r].action,rules[r].start)},Lexer.prototype.pushState=function(state){(this.stateTrail=this.stateTrail||[0]).push(this.state=state)},Lexer.prototype.popState=function(state){for(this.stateTrail=this.stateTrail||[0];state&&this.stateTrail[this.stateTrail.length-1]!==state;)this.stateTrail.splice(-1);this.stateTrail.splice(-1),this.state=this.stateTrail[this.stateTrail.length-1]||0},Lexer.prototype.hasState=function(state){return~this.stateTrail.indexOf(state)},Lexer.prototype.postpone=function(value){this.postponed.push(value)},Lexer.prototype.expedite=function(){return this.postponed.splice(0)},Lexer.prototype.addErrorHandler=function(callback){this.errorHandlers.push(callback)},Lexer.prototype.removeErrorHandler=function(callback){var index;(index=this.errorHandlers.indexOf(callback)>-1)&&this.errorHandlers.splice(index,1)},Lexer.prototype.throwError=function(char){var e,args=[].slice.call(arguments);for(e=0;e<this.errorHandlers.length;e++)if(this.errorHandlers[e].apply(this,args)===!0)return!0;if(this.state)throw new Error("Unexpected character at index "+(this.index-1)+": "+char)},Lexer.defunct=Lexer.prototype.throwError},{"./rules":7,"./states":9,lex:17}],4:[function(require,module){module.exports={name:"End",regex:/$/,action:function(){var postponed=this.expedite();return postponed.length?{type:"STRING",value:postponed.join("")}:void 0},start:[0]}},{}],5:[function(require,module){var states=require("../states");module.exports={name:"Expression end",regex:/\]/,action:function(){return this.popState(states.EXPRESSION),{type:"/EXPRESSION"}},start:[states.EXPRESSION]}},{"../states":9}],6:[function(require,module){var states=require("../states");module.exports={name:"Expression start",regex:/\[/,action:function(){return this.pushState(states.EXPRESSION),{type:"EXPRESSION"}},start:[0,states.EXPRESSION]}},{"../states":9}],7:[function(require,module){module.exports=[require("./expression-start"),require("./expression-end"),require("./string"),require("./end")]},{"./end":4,"./expression-end":5,"./expression-start":6,"./string":8}],8:[function(require,module){var states=require("../states");module.exports={name:"String",regex:/./gi,action:function(match){return{type:"STRING",value:match}},start:[0,states.EXPRESSION]}},{"../states":9}],9:[function(require,module){module.exports={STRING:2,EXPRESSION:4}},{}],10:[function(require,module){function CompoundNode(nodes){this.raw=this.nodes=nodes}var extend=require("extend");CompoundNode.prototype.replace=function(){var context,result="",i=0,args=[].slice.call(arguments);for(args.unshift({}),args.unshift(!0),context=extend.apply(extend,args);i<this.nodes.length;i++)result+=this.nodes[i].replace(context);return result},module.exports=CompoundNode},{extend:16}],11:[function(require,module){function ExpressionNode(nodes,expressions){this.raw=nodes,this.nodes=nodes,this.expressions=expressions}ExpressionNode.prototype.replace=function(context){for(var expression="",i=0;i<this.nodes.length;i++)expression+=this.nodes[i].replace(context);return this.expressions.compile(expression)(context)},ExpressionNode.parse=function(token,index,tokens){for(var i=index+1,nodes=[],closed=!1;tokens[i]&&!closed;){switch(tokens[i].type){case"/EXPRESSION":closed=!0;break;default:nodes.push(this.nodeTypes[tokens[i].type].parse.call(this,tokens[i],i,tokens))}tokens.splice(i,1)}return new ExpressionNode(nodes,this.expressions)},module.exports=ExpressionNode},{}],12:[function(require,module){module.exports={STRING:require("./string"),COMPOUND:require("./compound"),EXPRESSION:require("./expression")}},{"./compound":10,"./expression":11,"./string":13}],13:[function(require,module){function StringNode(raw){this.raw=raw}StringNode.prototype.replace=function(){return this.raw},StringNode.parse=function(token,index,tokens){for(var value=token.value,i=index+1;tokens[i]&&"STRING"===tokens[i].type;)value+=tokens.splice(i,1)[0].value||"";return new StringNode(value)},module.exports=StringNode},{}],14:[function(require,module,exports){"use strict";function compile(src){var cached;if("string"!=typeof src)throw new TypeError("src must be a string, instead saw '"+typeof src+"'");return compile.cache?(cached=compile.cache[src],cached||(cached=compile.cache[src]=parser.parse(src)),cached):parser.parse(src)}function getFilter(name){return filters[name]}var parse=require("./parse.js"),filters={},Lexer=parse.Lexer,Parser=parse.Parser,lexer=new Lexer({}),parser=new Parser(lexer,getFilter);compile.cache={},exports.Lexer=Lexer,exports.Parser=Parser,exports.compile=compile,exports.filters=filters},{"./parse.js":15}],15:[function(require,module,exports){"use strict";function noop(){}function extend(dst,obj){var key;for(key in obj)obj.hasOwnProperty(key)&&(dst[key]=obj[key]);return dst}function isDefined(value){return"undefined"!=typeof value}function valueFn(value){return function(){return value}}function $parseMinErr(module,message){var args=arguments;throw message=message.replace(/{(\d)}/g,function(match){return args[2+parseInt(match[1])]}),new SyntaxError(message)}function lowercase(string){return"string"==typeof string?string.toLowerCase():string}function forEach(arr,iterator){arr.forEach(iterator)}function ensureSafeMemberName(name,fullExpression){if("constructor"===name)throw $parseMinErr("isecfld",'Referencing "constructor" field in Angular expressions is disallowed! Expression: {0}',fullExpression);return name}function ensureSafeObject(obj,fullExpression){if(obj){if(obj.constructor===obj)throw $parseMinErr("isecfn","Referencing Function in Angular expressions is disallowed! Expression: {0}",fullExpression);if(obj.document&&obj.location&&obj.alert&&obj.setInterval)throw $parseMinErr("isecwindow","Referencing the Window in Angular expressions is disallowed! Expression: {0}",fullExpression);if(obj.children&&(obj.nodeName||obj.prop&&obj.attr&&obj.find))throw $parseMinErr("isecdom","Referencing DOM nodes in Angular expressions is disallowed! Expression: {0}",fullExpression)}return obj}function setter(obj,path,setValue,fullExp){for(var key,element=path.split("."),i=0;element.length>1;i++){key=ensureSafeMemberName(element.shift(),fullExp);var propertyObj=obj[key];propertyObj||(propertyObj={},obj[key]=propertyObj),obj=propertyObj}return key=ensureSafeMemberName(element.shift(),fullExp),obj[key]=setValue,setValue}function cspSafeGetterFn(key0,key1,key2,key3,key4,fullExp){return ensureSafeMemberName(key0,fullExp),ensureSafeMemberName(key1,fullExp),ensureSafeMemberName(key2,fullExp),ensureSafeMemberName(key3,fullExp),ensureSafeMemberName(key4,fullExp),function(scope,locals){var pathVal=locals&&locals.hasOwnProperty(key0)?locals:scope;return null==pathVal?pathVal:(pathVal=pathVal[key0],key1?null==pathVal?void 0:(pathVal=pathVal[key1],key2?null==pathVal?void 0:(pathVal=pathVal[key2],key3?null==pathVal?void 0:(pathVal=pathVal[key3],key4?null==pathVal?void 0:pathVal=pathVal[key4]:pathVal):pathVal):pathVal):pathVal)}}function simpleGetterFn1(key0,fullExp){return ensureSafeMemberName(key0,fullExp),function(scope,locals){return null==scope?void 0:(locals&&locals.hasOwnProperty(key0)?locals:scope)[key0]}}function simpleGetterFn2(key0,key1,fullExp){return ensureSafeMemberName(key0,fullExp),ensureSafeMemberName(key1,fullExp),function(scope,locals){return null==scope?void 0:(scope=(locals&&locals.hasOwnProperty(key0)?locals:scope)[key0],null==scope?void 0:scope[key1])}}function getterFn(path,options,fullExp){if(getterFnCache.hasOwnProperty(path))return getterFnCache[path];var fn,pathKeys=path.split("."),pathKeysLength=pathKeys.length;if(1===pathKeysLength)fn=simpleGetterFn1(pathKeys[0],fullExp);else if(2===pathKeysLength)fn=simpleGetterFn2(pathKeys[0],pathKeys[1],fullExp);else if(options.csp)fn=6>pathKeysLength?cspSafeGetterFn(pathKeys[0],pathKeys[1],pathKeys[2],pathKeys[3],pathKeys[4],fullExp,options):function(scope,locals){var val,i=0;do val=cspSafeGetterFn(pathKeys[i++],pathKeys[i++],pathKeys[i++],pathKeys[i++],pathKeys[i++],fullExp,options)(scope,locals),locals=void 0,scope=val;while(pathKeysLength>i);return val};else{var code="var p;\n";forEach(pathKeys,function(key,index){ensureSafeMemberName(key,fullExp),code+="if(s == null) return undefined;\ns="+(index?"s":'((k&&k.hasOwnProperty("'+key+'"))?k:s)')+'["'+key+'"];\n'}),code+="return s;";var evaledFnGetter=new Function("s","k","pw",code);evaledFnGetter.toString=valueFn(code),fn=evaledFnGetter}return"hasOwnProperty"!==path&&(getterFnCache[path]=fn),fn}var OPERATORS={"null":function(){return null},"true":function(){return!0},"false":function(){return!1},undefined:noop,"+":function(self,locals,a,b){return a=a(self,locals),b=b(self,locals),isDefined(a)?isDefined(b)?a+b:a:isDefined(b)?b:void 0},"-":function(self,locals,a,b){return a=a(self,locals),b=b(self,locals),(isDefined(a)?a:0)-(isDefined(b)?b:0)},"*":function(self,locals,a,b){return a(self,locals)*b(self,locals)},"/":function(self,locals,a,b){return a(self,locals)/b(self,locals)},"%":function(self,locals,a,b){return a(self,locals)%b(self,locals)},"^":function(self,locals,a,b){return a(self,locals)^b(self,locals)},"=":noop,"===":function(self,locals,a,b){return a(self,locals)===b(self,locals)},"!==":function(self,locals,a,b){return a(self,locals)!==b(self,locals)},"==":function(self,locals,a,b){return a(self,locals)==b(self,locals)},"!=":function(self,locals,a,b){return a(self,locals)!=b(self,locals)},"<":function(self,locals,a,b){return a(self,locals)<b(self,locals)},">":function(self,locals,a,b){return a(self,locals)>b(self,locals)},"<=":function(self,locals,a,b){return a(self,locals)<=b(self,locals)},">=":function(self,locals,a,b){return a(self,locals)>=b(self,locals)},"&&":function(self,locals,a,b){return a(self,locals)&&b(self,locals)},"||":function(self,locals,a,b){return a(self,locals)||b(self,locals)},"&":function(self,locals,a,b){return a(self,locals)&b(self,locals)},"|":function(self,locals,a,b){return b(self,locals)(self,locals,a(self,locals))},"!":function(self,locals,a){return!a(self,locals)}},ESCAPE={n:"\n",f:"\f",r:"\r",t:"	",v:"","'":"'",'"':'"'},Lexer=function(options){this.options=options};Lexer.prototype={constructor:Lexer,lex:function(text){this.text=text,this.index=0,this.ch=void 0,this.lastCh=":",this.tokens=[];for(var token,json=[];this.index<this.text.length;){if(this.ch=this.text.charAt(this.index),this.is("\"'"))this.readString(this.ch);else if(this.isNumber(this.ch)||this.is(".")&&this.isNumber(this.peek()))this.readNumber();else if(this.isIdent(this.ch))this.readIdent(),this.was("{,")&&"{"===json[0]&&(token=this.tokens[this.tokens.length-1])&&(token.json=-1===token.text.indexOf("."));else if(this.is("(){}[].,;:?"))this.tokens.push({index:this.index,text:this.ch,json:this.was(":[,")&&this.is("{[")||this.is("}]:,")}),this.is("{[")&&json.unshift(this.ch),this.is("}]")&&json.shift(),this.index++;else{if(this.isWhitespace(this.ch)){this.index++;continue}var ch2=this.ch+this.peek(),ch3=ch2+this.peek(2),fn=OPERATORS[this.ch],fn2=OPERATORS[ch2],fn3=OPERATORS[ch3];fn3?(this.tokens.push({index:this.index,text:ch3,fn:fn3}),this.index+=3):fn2?(this.tokens.push({index:this.index,text:ch2,fn:fn2}),this.index+=2):fn?(this.tokens.push({index:this.index,text:this.ch,fn:fn,json:this.was("[,:")&&this.is("+-")}),this.index+=1):this.throwError("Unexpected next character ",this.index,this.index+1)}this.lastCh=this.ch}return this.tokens},is:function(chars){return-1!==chars.indexOf(this.ch)},was:function(chars){return-1!==chars.indexOf(this.lastCh)},peek:function(i){var num=i||1;return this.index+num<this.text.length?this.text.charAt(this.index+num):!1},isNumber:function(ch){return ch>="0"&&"9">=ch},isWhitespace:function(ch){return" "===ch||"\r"===ch||"	"===ch||"\n"===ch||""===ch||"Â "===ch},isIdent:function(ch){return ch>="a"&&"z">=ch||ch>="A"&&"Z">=ch||"_"===ch||"$"===ch},isExpOperator:function(ch){return"-"===ch||"+"===ch||this.isNumber(ch)},throwError:function(error,start,end){end=end||this.index;var colStr=isDefined(start)?"s "+start+"-"+this.index+" ["+this.text.substring(start,end)+"]":" "+end;throw $parseMinErr("lexerr","Lexer Error: {0} at column{1} in expression [{2}].",error,colStr,this.text)},readNumber:function(){for(var number="",start=this.index;this.index<this.text.length;){var ch=lowercase(this.text.charAt(this.index));if("."==ch||this.isNumber(ch))number+=ch;else{var peekCh=this.peek();if("e"==ch&&this.isExpOperator(peekCh))number+=ch;else if(this.isExpOperator(ch)&&peekCh&&this.isNumber(peekCh)&&"e"==number.charAt(number.length-1))number+=ch;else{if(!this.isExpOperator(ch)||peekCh&&this.isNumber(peekCh)||"e"!=number.charAt(number.length-1))break;this.throwError("Invalid exponent")}}this.index++}number=1*number,this.tokens.push({index:start,text:number,json:!0,fn:function(){return number}})},readIdent:function(){for(var lastDot,peekIndex,methodName,ch,parser=this,ident="",start=this.index;this.index<this.text.length&&(ch=this.text.charAt(this.index),"."===ch||this.isIdent(ch)||this.isNumber(ch));)"."===ch&&(lastDot=this.index),ident+=ch,this.index++;if(lastDot)for(peekIndex=this.index;peekIndex<this.text.length;){if(ch=this.text.charAt(peekIndex),"("===ch){methodName=ident.substr(lastDot-start+1),ident=ident.substr(0,lastDot-start),this.index=peekIndex;break}if(!this.isWhitespace(ch))break;peekIndex++}var token={index:start,text:ident};if(OPERATORS.hasOwnProperty(ident))token.fn=OPERATORS[ident],token.json=OPERATORS[ident];else{var getter=getterFn(ident,this.options,this.text);token.fn=extend(function(self,locals){return getter(self,locals)},{assign:function(self,value){return setter(self,ident,value,parser.text,parser.options)}})}this.tokens.push(token),methodName&&(this.tokens.push({index:lastDot,text:".",json:!1}),this.tokens.push({index:lastDot+1,text:methodName,json:!1}))},readString:function(quote){var start=this.index;this.index++;for(var string="",rawString=quote,escape=!1;this.index<this.text.length;){var ch=this.text.charAt(this.index);if(rawString+=ch,escape){if("u"===ch){var hex=this.text.substring(this.index+1,this.index+5);hex.match(/[\da-f]{4}/i)||this.throwError("Invalid unicode escape [\\u"+hex+"]"),this.index+=4,string+=String.fromCharCode(parseInt(hex,16))}else{var rep=ESCAPE[ch];string+=rep?rep:ch}escape=!1}else if("\\"===ch)escape=!0;else{if(ch===quote)return this.index++,void this.tokens.push({index:start,text:rawString,string:string,json:!0,fn:function(){return string}});string+=ch}this.index++}this.throwError("Unterminated quote",start)}};var Parser=function(lexer,$filter,options){this.lexer=lexer,this.$filter=$filter,this.options=options};Parser.ZERO=function(){return 0},Parser.prototype={constructor:Parser,parse:function(text){this.text=text,this.tokens=this.lexer.lex(text);var value=this.statements();return 0!==this.tokens.length&&this.throwError("is an unexpected token",this.tokens[0]),value.literal=!!value.literal,value.constant=!!value.constant,value},primary:function(){var primary;if(this.expect("("))primary=this.filterChain(),this.consume(")");else if(this.expect("["))primary=this.arrayDeclaration();else if(this.expect("{"))primary=this.object();else{var token=this.expect();primary=token.fn,primary||this.throwError("not a primary expression",token),token.json&&(primary.constant=!0,primary.literal=!0)}for(var next,context;next=this.expect("(","[",".");)"("===next.text?(primary=this.functionCall(primary,context),context=null):"["===next.text?(context=primary,primary=this.objectIndex(primary)):"."===next.text?(context=primary,primary=this.fieldAccess(primary)):this.throwError("IMPOSSIBLE");return primary},throwError:function(msg,token){throw $parseMinErr("syntax","Syntax Error: Token '{0}' {1} at column {2} of the expression [{3}] starting at [{4}].",token.text,msg,token.index+1,this.text,this.text.substring(token.index))},peekToken:function(){if(0===this.tokens.length)throw $parseMinErr("ueoe","Unexpected end of expression: {0}",this.text);return this.tokens[0]},peek:function(e1,e2,e3,e4){if(this.tokens.length>0){var token=this.tokens[0],t=token.text;if(t===e1||t===e2||t===e3||t===e4||!e1&&!e2&&!e3&&!e4)return token}return!1},expect:function(e1,e2,e3,e4){var token=this.peek(e1,e2,e3,e4);return token?(this.tokens.shift(),token):!1},consume:function(e1){this.expect(e1)||this.throwError("is unexpected, expecting ["+e1+"]",this.peek())},unaryFn:function(fn,right){return extend(function(self,locals){return fn(self,locals,right)},{constant:right.constant})},ternaryFn:function(left,middle,right){return extend(function(self,locals){return left(self,locals)?middle(self,locals):right(self,locals)},{constant:left.constant&&middle.constant&&right.constant})},binaryFn:function(left,fn,right){return extend(function(self,locals){return fn(self,locals,left,right)},{constant:left.constant&&right.constant})},statements:function(){for(var statements=[];;)if(this.tokens.length>0&&!this.peek("}",")",";","]")&&statements.push(this.filterChain()),!this.expect(";"))return 1===statements.length?statements[0]:function(self,locals){for(var value,i=0;i<statements.length;i++){var statement=statements[i];statement&&(value=statement(self,locals))}return value}},filterChain:function(){for(var token,left=this.expression();;){if(!(token=this.expect("|")))return left;left=this.binaryFn(left,token.fn,this.filter())}},filter:function(){for(var token=this.expect(),fn=this.$filter(token.text),argsFn=[];;){if(!(token=this.expect(":"))){var fnInvoke=function(self,locals,input){for(var args=[input],i=0;i<argsFn.length;i++)args.push(argsFn[i](self,locals));return fn.apply(self,args)};return function(){return fnInvoke}}argsFn.push(this.expression())}},expression:function(){return this.assignment()},assignment:function(){var right,token,left=this.ternary();return(token=this.expect("="))?(left.assign||this.throwError("implies assignment but ["+this.text.substring(0,token.index)+"] can not be assigned to",token),right=this.ternary(),function(scope,locals){return left.assign(scope,right(scope,locals),locals)}):left},ternary:function(){var middle,token,left=this.logicalOR();return(token=this.expect("?"))?(middle=this.ternary(),(token=this.expect(":"))?this.ternaryFn(left,middle,this.ternary()):void this.throwError("expected :",token)):left},logicalOR:function(){for(var token,left=this.logicalAND();;){if(!(token=this.expect("||")))return left;left=this.binaryFn(left,token.fn,this.logicalAND())}},logicalAND:function(){var token,left=this.equality();return(token=this.expect("&&"))&&(left=this.binaryFn(left,token.fn,this.logicalAND())),left},equality:function(){var token,left=this.relational();return(token=this.expect("==","!=","===","!=="))&&(left=this.binaryFn(left,token.fn,this.equality())),left},relational:function(){var token,left=this.additive();return(token=this.expect("<",">","<=",">="))&&(left=this.binaryFn(left,token.fn,this.relational())),left},additive:function(){for(var token,left=this.multiplicative();token=this.expect("+","-");)left=this.binaryFn(left,token.fn,this.multiplicative());return left},multiplicative:function(){for(var token,left=this.unary();token=this.expect("*","/","%");)left=this.binaryFn(left,token.fn,this.unary());return left},unary:function(){var token;return this.expect("+")?this.primary():(token=this.expect("-"))?this.binaryFn(Parser.ZERO,token.fn,this.unary()):(token=this.expect("!"))?this.unaryFn(token.fn,this.unary()):this.primary()},fieldAccess:function(object){var parser=this,field=this.expect().text,getter=getterFn(field,this.options,this.text);return extend(function(scope,locals,self){return getter(self||object(scope,locals))},{assign:function(scope,value,locals){return setter(object(scope,locals),field,value,parser.text,parser.options)}})},objectIndex:function(obj){var parser=this,indexFn=this.expression();return this.consume("]"),extend(function(self,locals){var v,o=obj(self,locals),i=indexFn(self,locals);return o?v=ensureSafeObject(o[i],parser.text):void 0},{assign:function(self,value,locals){var key=indexFn(self,locals),safe=ensureSafeObject(obj(self,locals),parser.text);return safe[key]=value}})},functionCall:function(fn,contextGetter){var argsFn=[];if(")"!==this.peekToken().text)do argsFn.push(this.expression());while(this.expect(","));this.consume(")");var parser=this;return function(scope,locals){for(var args=[],context=contextGetter?contextGetter(scope,locals):scope,i=0;i<argsFn.length;i++)args.push(argsFn[i](scope,locals));var fnPtr=fn(scope,locals,context)||noop;ensureSafeObject(context,parser.text),ensureSafeObject(fnPtr,parser.text);var v=fnPtr.apply?fnPtr.apply(context,args):fnPtr(args[0],args[1],args[2],args[3],args[4]);return ensureSafeObject(v,parser.text)}},arrayDeclaration:function(){var elementFns=[],allConstant=!0;if("]"!==this.peekToken().text)do{if(this.peek("]"))break;var elementFn=this.expression();elementFns.push(elementFn),elementFn.constant||(allConstant=!1)}while(this.expect(","));return this.consume("]"),extend(function(self,locals){for(var array=[],i=0;i<elementFns.length;i++)array.push(elementFns[i](self,locals));return array},{literal:!0,constant:allConstant})},object:function(){var keyValues=[],allConstant=!0;if("}"!==this.peekToken().text)do{if(this.peek("}"))break;var token=this.expect(),key=token.string||token.text;this.consume(":");var value=this.expression();keyValues.push({key:key,value:value}),value.constant||(allConstant=!1)}while(this.expect(","));return this.consume("}"),extend(function(self,locals){for(var object={},i=0;i<keyValues.length;i++){var keyValue=keyValues[i];object[keyValue.key]=keyValue.value(self,locals)}return object},{literal:!0,constant:allConstant})}};var getterFnCache={};exports.Lexer=Lexer,exports.Parser=Parser},{}],16:[function(require,module){var undefined,hasOwn=Object.prototype.hasOwnProperty,toString=Object.prototype.toString,isPlainObject=function(obj){"use strict";if(!obj||"[object Object]"!==toString.call(obj))return!1;var has_own_constructor=hasOwn.call(obj,"constructor"),has_is_property_of_method=obj.constructor&&obj.constructor.prototype&&hasOwn.call(obj.constructor.prototype,"isPrototypeOf");if(obj.constructor&&!has_own_constructor&&!has_is_property_of_method)return!1;var key;for(key in obj);return key===undefined||hasOwn.call(obj,key)};module.exports=function extend(){"use strict";var options,name,src,copy,copyIsArray,clone,target=arguments[0],i=1,length=arguments.length,deep=!1;for("boolean"==typeof target?(deep=target,target=arguments[1]||{},i=2):("object"!=typeof target&&"function"!=typeof target||null==target)&&(target={});length>i;++i)if(options=arguments[i],null!=options)for(name in options)src=target[name],copy=options[name],target!==copy&&(deep&&copy&&(isPlainObject(copy)||(copyIsArray=Array.isArray(copy)))?(copyIsArray?(copyIsArray=!1,clone=src&&Array.isArray(src)?src:[]):clone=src&&isPlainObject(src)?src:{},target[name]=extend(deep,clone,copy)):copy!==undefined&&(target[name]=copy));return target}},{}],17:[function(require,module){function Lexer(defunct){function scan(){for(var matches=[],index=0,state=this.state,lastIndex=this.index,input=this.input,i=0,length=rules.length;length>i;i++){var rule=rules[i],start=rule.start,states=start.length;if(!states||start.indexOf(state)>=0||state%2&&1===states&&!start[0]){var pattern=rule.pattern;pattern.lastIndex=lastIndex;var result=pattern.exec(input);if(result&&result.index===lastIndex){var j=matches.push({result:result,action:rule.action,length:result[0].length});for(rule.global&&(index=j);--j>index;){var k=j-1;if(matches[j].length>matches[k].length){var temple=matches[j];matches[j]=matches[k],matches[k]=temple}}}}}return matches}"function"!=typeof defunct&&(defunct=Lexer.defunct);var tokens=[],rules=[],remove=0;this.state=0,this.index=0,this.input="",this.addRule=function(pattern,action,start){var global=pattern.global;if(!global){var flags="g";pattern.multiline&&(flags+="m"),pattern.ignoreCase&&(flags+="i"),pattern=new RegExp(pattern.source,flags)}return"[object Array]"!==Object.prototype.toString.call(start)&&(start=[0]),rules.push({pattern:pattern,global:global,action:action,start:start}),this},this.setInput=function(input){return remove=0,this.state=0,this.index=0,tokens.length=0,this.input=input,this},this.lex=function(){if(tokens.length)return tokens.shift();for(this.reject=!0;this.index<=this.input.length;){for(var matches=scan.call(this).splice(remove),index=this.index;matches.length&&this.reject;){var match=matches.shift(),result=match.result,length=match.length;this.index+=length,this.reject=!1,remove++;var token=match.action.apply(this,result);if(this.reject)this.index=result.index;else if("undefined"!=typeof token)switch(Object.prototype.toString.call(token)){case"[object Array]":tokens=token.slice(1),token=token[0];default:return length&&(remove=0),token}}var input=this.input;if(index<input.length)if(this.reject){remove=0;var token=defunct.call(this,input.charAt(this.index++));if("undefined"!=typeof token)return"[object Array]"===Object.prototype.toString.call(token)?(tokens=token.slice(1),token[0]):token}else this.index!==index&&(remove=0),this.reject=!0;else{if(!matches.length)break;this.reject=!0}}}}"object"==typeof module&&"object"==typeof module.exports&&(module.exports=Lexer),Lexer.defunct=function(char){throw new Error("Unexpected character at index "+(this.index-1)+": "+char)}},{}]},{},[1])(1)});